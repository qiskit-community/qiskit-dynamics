<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="How-to use pulse schedules generated by Qiskit Pulse with JAX transformations" href="how_to_use_pulse_schedule_for_jax_jit.html" /><link rel="prev" title="How-to customize simulations using model transformations and array libraries" href="how_to_configure_simulations.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>How-to use Dyson and Magnus based solvers - Qiskit Dynamics 0.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=82a976d7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/qiskit-sphinx-theme.css?v=fe84956c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/qiskit-ecosystem.css?v=745c5aa7" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
<script src="../_static/js/web-components/top-nav-bar.js"></script></head>
  <body>
    
    <script>document.body.dataset.theme = "light";</script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
      <defs><style>.cls-1{fill:none;}</style></defs>
      <path d="M28,4H4A2,2,0,0,0,2,6V26a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V6A2,2,0,0,0,28,4ZM4,6H20V26H4ZM28,26H22V6h6Z"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
      <defs><style>.cls-1{fill:none;}</style></defs>
      <rect x="4" y="6" width="24" height="2"/>
      <rect x="4" y="24" width="24" height="2"/>
      <rect x="4" y="12" width="24" height="2"/>
      <rect x="4" y="18" width="24" height="2"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg version="1.1" id="icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
         viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve"><polygon points="22,16 12,26 10.6,24.6 19.2,16 10.6,7.4 12,6 " stroke="currentColor"/>
      <rect id="_x3C_Transparent_Rectangle_x3E_" fill="none" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-new-tab" viewBox="0 0 32 32">
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
      <defs>
        <style>
          .cls-1 {
            fill: none;
          }
        </style>
      </defs>
      <path fill="#6929C4" d="M26,28H6a2.0027,2.0027,0,0,1-2-2V6A2.0027,2.0027,0,0,1,6,4H16V6H6V26H26V16h2V26A2.0027,2.0027,0,0,1,26,28Z"/>
      <polygon fill="#6929C4" points="20 2 20 4 26.586 4 18 12.586 19.414 14 28 5.414 28 12 30 12 30 2 20 2"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Qiskit Dynamics 0.5.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-brand">
  <a href="https://www.qiskit.org/ecosystem">
    <div class="sidebar-logo-container">
      <img class="sidebar-logo" src="../_static/images/ecosystem-logo.svg" alt="Qiskit Ecosystem logo"/>
    </div>
  </a>
  
  <span class="sidebar-brand-text">Qiskit Dynamics 0.5.0 documentation</span>
</div><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/Rabi_oscillations.html">Simulating Rabi oscillations with noise and decoherence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/Lindblad_dynamics_simulation.html">Solving the Lindblad dynamics of a qubit chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/qiskit_pulse.html">Simulating Qiskit Pulse Schedules with Qiskit Dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/optimizing_pulse_sequence.html">Gradient optimization of a pulse sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/dynamics_backend.html">Simulating backends at the pulse-level with <code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicsBackend</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">User Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="how_to_use_different_array_libraries.html">How-to use different array libraries and types with Qiskit Dynamics</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_configure_simulations.html">How-to customize simulations using model transformations and array libraries</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">How-to use Dyson and Magnus based solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_pulse_schedule_for_jax_jit.html">How-to use pulse schedules generated by Qiskit Pulse with JAX transformations</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../apidocs/index.html">API References</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of API References</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/solvers.html">Solvers (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.solvers</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Solvers (qiskit_dynamics.solvers)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.solvers.Solver.html">Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html">DysonSolver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.solvers.MagnusSolver.html">MagnusSolver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.solvers.solve_ode.html">qiskit_dynamics.solvers.solve_ode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.solvers.solve_lmde.html">qiskit_dynamics.solvers.solve_lmde</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/backend.html">Backend (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.backend</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Backend (qiskit_dynamics.backend)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.backend.DynamicsBackend.html">DynamicsBackend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.backend.default_experiment_result_function.html">qiskit_dynamics.backend.default_experiment_result_function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.backend.parse_backend_hamiltonian_dict.html">qiskit_dynamics.backend.parse_backend_hamiltonian_dict</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/models.html">Models (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.models</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Models (qiskit_dynamics.models)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.models.HamiltonianModel.html">HamiltonianModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.models.LindbladModel.html">LindbladModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.models.GeneratorModel.html">GeneratorModel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.models.RotatingFrame.html">RotatingFrame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.models.rotating_wave_approximation.html">qiskit_dynamics.models.rotating_wave_approximation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/signals.html">Signals (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.signals</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Signals (qiskit_dynamics.signals)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.signals.Signal.html">Signal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.signals.DiscreteSignal.html">DiscreteSignal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.signals.SignalSum.html">SignalSum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.signals.DiscreteSignalSum.html">DiscreteSignalSum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.signals.SignalList.html">SignalList</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.signals.Convolution.html">Convolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.signals.IQMixer.html">IQMixer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/pulse.html">Pulse (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.pulse</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Pulse (qiskit_dynamics.pulse)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.pulse.InstructionToSignals.html">InstructionToSignals</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/perturbation.html">Perturbation Theory (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.perturbation</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Perturbation Theory (qiskit_dynamics.perturbation)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.perturbation.solve_lmde_perturbation.html">qiskit_dynamics.perturbation.solve_lmde_perturbation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.perturbation.ArrayPolynomial.html">ArrayPolynomial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.perturbation.PowerSeriesData.html">PowerSeriesData</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.perturbation.DysonLikeData.html">DysonLikeData</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../apidocs/arraylias.html">Arraylias (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.arraylias</span></code>)</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/array.html">Array Module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.array</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Array Module (qiskit_dynamics.array)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.array.Array.html">Array</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.array.wrap.html">qiskit_dynamics.array.wrap</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../apidocs/dispatch.html">Dispatch Module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit_dynamics.dispatch</span></code>)</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Dispatch Module (qiskit_dynamics.dispatch)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.dispatch.asarray.html">qiskit_dynamics.dispatch.asarray</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stubs/qiskit_dynamics.dispatch.requires_backend.html">qiskit_dynamics.dispatch.requires_backend</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../discussions/index.html">Discussions</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Discussions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../discussions/dyson_magnus.html">Time-dependent perturbation theory and multi-variable series expansions review</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>

</div><div class="qiskit-previous-releases-container">
    <input id="previous-releases-checkbox" name="previous-releases-checkbox" role="switch" type="checkbox">
    <div class="qiskit-previous-releases-header-container"><label for="previous-releases-checkbox">
            <p role="note">Previous Releases</p>
            <div class="qiskit-previous-releases-toggle-container">
                <div class="visually-hidden">Toggle navigation of Previous Releases</div>
                <i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i>
            </div>
        </label>
    </div>
    <div class="qiskit-previous-releases-list-container">
        <ul>
        
            <li><a href="/qiskit-dynamics/stable/0.4/index.html" rel="nofollow noindex">0.4</a></li>
        
        </ul>
    </div>
</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="how-to-use-dyson-and-magnus-based-solvers">
<h1>How-to use Dyson and Magnus based solvers<a class="headerlink" href="#how-to-use-dyson-and-magnus-based-solvers" title="Link to this heading">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an advanced topic — utilizing perturbation-theory based solvers requires detailed
knowledge of the structure of the differential equations involved, as well as manual tuning of
the solver parameters. See the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> and <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.MagnusSolver.html#qiskit_dynamics.solvers.MagnusSolver" title="qiskit_dynamics.solvers.MagnusSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">MagnusSolver</span></code></a> documentation
for API details. Also, see <a class="footnote-reference brackets" href="#footcite-puzzuoli-algorithms-2023" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> for a detailed explanation of
the solvers, which varies and builds on the core idea introduced in
<a class="footnote-reference brackets" href="#footcite-shillito-fast-2020" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The circumstances under which perturbative solvers outperform traditional solvers, and which
parameter sets to use, is nuanced. Perturbative solvers executed with JAX are setup to use more
parallelization within a single solver run than typical solvers, and thus it is
circumstance-specific whether the trade-off between speed of a single run and resource
consumption is advantageous. Due to the parallelized nature, the comparison of execution times
demonstrated in this userguide are highly hardware-dependent.</p>
</div>
<p>In this tutorial we walk through how to use perturbation-theory based solvers. For information on
how these solvers work, see the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> and <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.MagnusSolver.html#qiskit_dynamics.solvers.MagnusSolver" title="qiskit_dynamics.solvers.MagnusSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">MagnusSolver</span></code></a> class
documentation, as well as the perturbative expansion background information provided in
<a class="reference internal" href="../discussions/dyson_magnus.html#perturbation-review"><span class="std std-ref">Time-dependent perturbation theory and multi-variable series expansions review</span></a>.</p>
<p>We use a simple transmon model:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[H(t) = 2 \pi \nu N + \pi \alpha N(N-I) + s(t) \times 2 \pi r (a + a^\dagger)\]</div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N\)</span>, <span class="math notranslate nohighlight">\(a\)</span>, and <span class="math notranslate nohighlight">\(a^\dagger\)</span> are, respectively, the number, annihilation, and
creation operators.</p></li>
<li><p><span class="math notranslate nohighlight">\(\nu\)</span> is the qubit frequency and <span class="math notranslate nohighlight">\(r\)</span> is the drive strength.</p></li>
<li><p><span class="math notranslate nohighlight">\(s(t)\)</span> is the drive signal, which we will take to be on resonance with envelope <span class="math notranslate nohighlight">\(f(t)
= A \frac{4t (T - t)}{T^2}\)</span> for a given amplitude <span class="math notranslate nohighlight">\(A\)</span> and total time <span class="math notranslate nohighlight">\(T\)</span>.</p></li>
</ul>
<p>We will walk through the following steps:</p>
<ol class="arabic simple">
<li><p>Configure JAX.</p></li>
<li><p>Construct the model.</p></li>
<li><p>How-to construct and simulate using the Dyson-based perturbative solver.</p></li>
<li><p>Simulate using a traditional ODE solver, comparing speed.</p></li>
<li><p>How-to construct and simulate using the Magnus-based perturbative solver.</p></li>
</ol>
<section id="configure-jax">
<h2>1. Configure JAX<a class="headerlink" href="#configure-jax" title="Link to this heading">#</a></h2>
<p>First, configure JAX to run on CPU in 64 bit mode. See the <a class="reference internal" href="how_to_use_different_array_libraries.html#how-to-use-different-array-libraries"><span class="std std-ref">userguide on using JAX</span></a> for a more detailed explanation of how to work with JAX in Qiskit
Dynamics.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># configure jax to use 64 bit mode</span>
<span class="kn">import</span> <span class="nn">jax</span>
<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># tell JAX we are using CPU if using a system without a GPU</span>
<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s1">&#39;jax_platform_name&#39;</span><span class="p">,</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="construct-the-model">
<h2>2. Construct the model<a class="headerlink" href="#construct-the-model" title="Link to this heading">#</a></h2>
<p>First, we construct the model described in the introduction. We use a relatively high dimension for
the oscillator system state space to accentuate the speed difference between the perturbative
solvers and the traditional ODE solver. The higher dimensionality introduces higher frequencies into
the model, which will slow down both the ODE solver and the initial construction of the perturbative
solver. However after the initial construction, the higher frequencies in the model have no impact
on the perturbative solver speed.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">dim</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Oscillator dimension</span>

<span class="n">v</span> <span class="o">=</span> <span class="mf">5.</span>  <span class="c1"># Transmon frequency in GHz</span>
<span class="n">anharm</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.33</span>  <span class="c1"># Transmon anharmonicity in GHz</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1"># Transmon drive coupling in GHz</span>

<span class="c1"># Construct cavity operators</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">adag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span>

<span class="c1"># Static part of Hamiltonian</span>
<span class="n">static_hamiltonian</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">N</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">anharm</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span>
<span class="c1"># Drive term of Hamiltonian</span>
<span class="n">drive_hamiltonian</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">adag</span><span class="p">)</span>

<span class="c1"># total simulation time</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">r</span>

<span class="c1"># Drive envelope function</span>
<span class="n">envelope_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
<section id="how-to-construct-and-simulate-using-the-dyson-based-perturbative-solver">
<h2>3. How-to construct and simulate using the Dyson-based perturbative solver<a class="headerlink" href="#how-to-construct-and-simulate-using-the-dyson-based-perturbative-solver" title="Link to this heading">#</a></h2>
<p>Setting up a <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> requires more setup than the standard <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.Solver.html#qiskit_dynamics.solvers.Solver" title="qiskit_dynamics.solvers.Solver"><code class="xref py py-class docutils literal notranslate"><span class="pre">Solver</span></code></a>, as the
user must specify several configuration parameters, along with the structure of the differential
equation:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> requires direct specification of the LMDE to the solver. If we are
simulating the Schrodinger equation, we need to multiply the Hamiltonian terms by <code class="docutils literal notranslate"><span class="pre">-1j</span></code> when
describing the LMDE operators.</p></li>
<li><p>The <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> is a fixed step solver, with the step size being fixed at instantiation.
This step size must be chosen in conjunction with the <code class="docutils literal notranslate"><span class="pre">expansion_order</span></code> to ensure that a
suitable accuracy is attained.</p></li>
<li><p>Over each fixed time-step the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> solves by computing a truncated perturbative
expansion.</p>
<ul>
<li><p>To compute the truncated perturbative expansion, the signal envelopes are approximated as a
linear combination of Chebyshev polynomials.</p></li>
<li><p>The order of the Chebyshev approximations, along with central carrier frequencies for defining
the “envelope” of each <a class="reference internal" href="../stubs/qiskit_dynamics.signals.Signal.html#qiskit_dynamics.signals.Signal" title="qiskit_dynamics.signals.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code></a>, must be provided at instantiation.</p></li>
</ul>
</li>
</ul>
<p>See the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> API docs for more details.</p>
<p>For our example Hamiltonian we configure the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> as follows:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="kn">from</span> <span class="nn">qiskit_dynamics</span> <span class="kn">import</span> <span class="n">DysonSolver</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">dyson_solver</span> <span class="o">=</span> <span class="n">DysonSolver</span><span class="p">(</span>
    <span class="n">operators</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">drive_hamiltonian</span><span class="p">],</span>
    <span class="n">rotating_frame</span><span class="o">=-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">static_hamiltonian</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
    <span class="n">carrier_freqs</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">],</span>
    <span class="n">chebyshev_orders</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">expansion_order</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">integration_method</span><span class="o">=</span><span class="s1">&#39;jax_odeint&#39;</span><span class="p">,</span>
    <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span>
    <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-12</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 2.71 s, sys: 478 ms, total: 3.19 s
Wall time: 2.79 s
</pre></div>
</div>
</div>
</div>
<p>The above parameters are chosen so that the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> is fast and produces high accuracy
solutions (measured and confirmed after the fact). The relatively large step size <code class="docutils literal notranslate"><span class="pre">dt</span> <span class="pre">=</span> <span class="pre">0.1</span></code> is
chosen for speed: the larger the step size, the fewer steps required. To ensure high accuracy given
the large step size, we choose a high expansion order, and utilize a linear envelope approximation
scheme by setting the <code class="docutils literal notranslate"><span class="pre">chebyshev_order</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code> for the single drive signal.</p>
<p>Similar to the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.Solver.html#qiskit_dynamics.solvers.Solver" title="qiskit_dynamics.solvers.Solver"><code class="xref py py-class docutils literal notranslate"><span class="pre">Solver</span></code></a> interface, the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver.solve" title="qiskit_dynamics.solvers.DysonSolver.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DysonSolver.solve()</span></code></a> method can be called to
simulate the system for a given list of signals, initial state, start time, and number of time steps
of length <code class="docutils literal notranslate"><span class="pre">dt</span></code>.</p>
<p>To properly compare the speed of <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a> to a traditional ODE solver, we write
JAX-compilable functions wrapping each that, given an amplitude value, returns the final unitary
over the interval <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">(T</span> <span class="pre">//</span> <span class="pre">dt)</span> <span class="pre">*</span> <span class="pre">dt]</span></code> for an on-resonance drive with envelope shape given by
<code class="docutils literal notranslate"><span class="pre">envelope_func</span></code> above. Running compiled versions of these functions gives a sense of the speeds
attainable by these solvers.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit_dynamics</span> <span class="kn">import</span> <span class="n">Signal</span>
<span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="c1"># Jit the function to improve performance for repeated calls</span>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">dyson_sim</span><span class="p">(</span><span class="n">amp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For a given envelope amplitude, simulate the final unitary using the</span>
<span class="sd">    Dyson solver.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drive_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">envelope_func</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">carrier_freq</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dyson_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
        <span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="n">drive_signal</span><span class="p">],</span>
        <span class="n">y0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span>
        <span class="n">t0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">n_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span> <span class="o">//</span> <span class="n">dt</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>First run includes compile time.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> yf_dyson = dyson_sim(1.).block_until_ready()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 635 ms, sys: 27.4 ms, total: 662 ms
Wall time: 647 ms
</pre></div>
</div>
</div>
</div>
<p>Once JIT compilation has been performance we can benchmark the performance of the JIT-compiled
solver:</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> yf_dyson = dyson_sim(1.).block_until_ready()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 11.7 ms, sys: 0 ns, total: 11.7 ms
Wall time: 4.56 ms
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparison-to-traditional-ode-solver">
<h2>4. Comparison to traditional ODE solver<a class="headerlink" href="#comparison-to-traditional-ode-solver" title="Link to this heading">#</a></h2>
<p>We now construct the same simulation using a standard solver to compare accuracy and simulation
speed.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit_dynamics</span> <span class="kn">import</span> <span class="n">Solver</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span>
    <span class="n">static_hamiltonian</span><span class="o">=</span><span class="n">static_hamiltonian</span><span class="p">,</span>
    <span class="n">hamiltonian_operators</span><span class="o">=</span><span class="p">[</span><span class="n">drive_hamiltonian</span><span class="p">],</span>
    <span class="n">rotating_frame</span><span class="o">=</span><span class="n">static_hamiltonian</span>
<span class="p">)</span>

<span class="c1"># specify tolerance as an argument to run the simulation at different tolerances</span>
<span class="k">def</span> <span class="nf">ode_sim</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
    <span class="n">drive_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">envelope_func</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">carrier_freq</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
        <span class="n">t_span</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">T</span> <span class="o">//</span> <span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span><span class="p">],</span>
        <span class="n">y0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span>
        <span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="n">drive_signal</span><span class="p">],</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;jax_odeint&#39;</span><span class="p">,</span>
        <span class="n">atol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="n">tol</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Simulate with low tolerance for comparison to high accuracy solution.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yf_low_tol</span> <span class="o">=</span> <span class="n">ode_sim</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1e-13</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">yf_low_tol</span> <span class="o">-</span> <span class="n">yf_dyson</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>6.529550206930476e-07
</pre></div>
</div>
</div>
</div>
<p>For speed comparison, compile at a tolerance with similar accuracy.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jit_ode_sim</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">amp</span><span class="p">:</span> <span class="n">ode_sim</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">))</span>

<span class="o">%</span><span class="k">time</span> yf_ode = jit_ode_sim(1.).block_until_ready()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 440 ms, sys: 17 ms, total: 456 ms
Wall time: 450 ms
</pre></div>
</div>
</div>
</div>
<p>Measure compiled time.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> yf_ode = jit_ode_sim(1.).block_until_ready()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 46.4 ms, sys: 454 µs, total: 46.8 ms
Wall time: 46.3 ms
</pre></div>
</div>
</div>
</div>
<p>Confirm similar accuracy solution.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">yf_low_tol</span> <span class="o">-</span> <span class="n">yf_ode</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>8.67211035081537e-07
</pre></div>
</div>
</div>
</div>
<p>Here we see that, once compiled, the Dyson-based solver has a significant speed advantage over the
traditional solver, at the expense of the initial compilation time and the technical aspect of using
the solver.</p>
</section>
<section id="how-to-construct-and-simulate-using-the-magnus-based-perturbation-solver">
<h2>5. How-to construct and simulate using the Magnus-based perturbation solver<a class="headerlink" href="#how-to-construct-and-simulate-using-the-magnus-based-perturbation-solver" title="Link to this heading">#</a></h2>
<p>Next, we repeat our example using the Magnus-based perturbative solver. Setup of the
<a class="reference internal" href="../stubs/qiskit_dynamics.solvers.MagnusSolver.html#qiskit_dynamics.solvers.MagnusSolver" title="qiskit_dynamics.solvers.MagnusSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">MagnusSolver</span></code></a> is similar to the <a class="reference internal" href="../stubs/qiskit_dynamics.solvers.DysonSolver.html#qiskit_dynamics.solvers.DysonSolver" title="qiskit_dynamics.solvers.DysonSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">DysonSolver</span></code></a>, but it uses the Magnus expansion and
matrix exponentiation to simulate over each fixed time step.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="kn">from</span> <span class="nn">qiskit_dynamics</span> <span class="kn">import</span> <span class="n">MagnusSolver</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">magnus_solver</span> <span class="o">=</span> <span class="n">MagnusSolver</span><span class="p">(</span>
    <span class="n">operators</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">drive_hamiltonian</span><span class="p">],</span>
    <span class="n">rotating_frame</span><span class="o">=-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">static_hamiltonian</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
    <span class="n">carrier_freqs</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">],</span>
    <span class="n">chebyshev_orders</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">expansion_order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">integration_method</span><span class="o">=</span><span class="s1">&#39;jax_odeint&#39;</span><span class="p">,</span>
    <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span>
    <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-12</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.42 s, sys: 44.4 ms, total: 1.47 s
Wall time: 1.46 s
</pre></div>
</div>
</div>
</div>
<p>Setup simulation function.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">magnus_sim</span><span class="p">(</span><span class="n">amp</span><span class="p">):</span>
    <span class="n">drive_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">envelope_func</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">carrier_freq</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">magnus_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
        <span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="n">drive_signal</span><span class="p">],</span>
        <span class="n">y0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span>
        <span class="n">t0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">n_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span> <span class="o">//</span> <span class="n">dt</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>First run includes compile time.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> yf_magnus = magnus_sim(1.).block_until_ready()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.26 s, sys: 56.6 ms, total: 1.31 s
Wall time: 1.29 s
</pre></div>
</div>
</div>
</div>
<p>Second run demonstrates speed of the simulation.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> yf_magnus = magnus_sim(1.).block_until_ready()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>CPU times: user 20.7 ms, sys: 520 µs, total: 21.3 ms
Wall time: 17.6 ms
</pre></div>
</div>
</div>
</div>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">yf_magnus</span> <span class="o">-</span> <span class="n">yf_low_tol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>6.678901371612617e-07
</pre></div>
</div>
</div>
</div>
<p>Observe comparable accuracy at a lower order in the expansion, albeit with a modest speed up as
compared to the Dyson-based solver.</p>
<div class="docutils container" id="id3">
<p class="rubric">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-puzzuoli-algorithms-2023" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>D. Puzzuoli, S. F. Lin, M. Malekakhlagh, E. Pritchett, B. Rosand, and C. J. Wood. Algorithms for perturbative analysis and simulation of quantum dynamics. <em>Journal of Computational Physics</em>, 2023. <a class="reference external" href="https://doi.org/10.1016/j.jcp.2023.112262">doi:10.1016/j.jcp.2023.112262</a>.</p>
</aside>
<aside class="footnote brackets" id="footcite-shillito-fast-2020" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>R. Shillito, J. A. Gross, A. Di Paolo, É. Genois, and A. Blais. Fast and differentiable simulation of driven quantum systems. <em>Physical Review Research</em>, 3(3):033266, 2021. Publisher: American Physical Society. <a class="reference external" href="https://doi.org/10.1103/PhysRevResearch.3.033266">doi:10.1103/PhysRevResearch.3.033266</a>.</p>
</aside>
</aside>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        <div class="related-pages">
          <a class="next-page" href="how_to_use_pulse_schedule_for_jax_jit.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">How-to use pulse schedules generated by Qiskit Pulse with JAX transformations</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="how_to_configure_simulations.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">How-to customize simulations using model transformations and array libraries</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020, Qiskit Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 2024/03/22</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">How-to use Dyson and Magnus based solvers</a><ul>
<li><a class="reference internal" href="#configure-jax">1. Configure JAX</a></li>
<li><a class="reference internal" href="#construct-the-model">2. Construct the model</a></li>
<li><a class="reference internal" href="#how-to-construct-and-simulate-using-the-dyson-based-perturbative-solver">3. How-to construct and simulate using the Dyson-based perturbative solver</a></li>
<li><a class="reference internal" href="#comparison-to-traditional-ode-solver">4. Comparison to traditional ODE solver</a></li>
<li><a class="reference internal" href="#how-to-construct-and-simulate-using-the-magnus-based-perturbation-solver">5. How-to construct and simulate using the Magnus-based perturbation solver</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=1dd76d02"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/qiskit-sphinx-theme.js?v=4d77b8ca"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>